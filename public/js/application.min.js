$.ui.plugin.add("draggable","alsoDrag",{start:function(){var e,t,i;t=$(this).data("ui-draggable"),e=t.options,i=function(e){$(e).each(function(){var e;e=$(this),e.data("ui-draggable-alsoDrag",{top:parseInt(e.css("top"),10),left:parseInt(e.css("left"),10)})})},"object"!=typeof e.alsoDrag||e.alsoDrag.parentNode?i(e.alsoDrag):e.alsoDrag.length?(e.alsoDrag=e.alsoDrag[0],i(e.alsoDrag)):$.each(e.alsoDrag,function(e){i(e)})},drag:function(){var e,t,i,s,l,a;l=$(this).data("ui-draggable"),t=l.options,s=l.originalSize,i=l.originalPosition,e={top:l.position.top-i.top||0,left:l.position.left-i.left||0},a=function(t){$(t).each(function(){var t,i,s,l;i=$(this),s=$(this).data("ui-draggable-alsoDrag"),l={},t=["top","left"],$.each(t,function(t,i){var a;a=(s[i]||0)+(e[i]||0),l[i]=a||null}),i.css(l)})},"object"!=typeof t.alsoDrag||t.alsoDrag.nodeType?a(t.alsoDrag):$.each(t.alsoDrag,function(e,t){a(e,t)})},stop:function(){$(this).removeData("ui-draggable-alsoDrag")}});var addBox,addGroupBox,displayCSSChunk,displayOnlyDefined,getColorLuminance,groupctr,hex,hexDigits,inlineToPanel,jsonToClass,jsonToPanel,loadBox,makeActive,panelToInline,panelToJSON,rgb2hex,setDefaultStyle,updateClasses;groupctr=0,$(document).keydown(function(e){var t;if(t=e.keyCode,$(".el-active").length>0){if(t>=38&&40>=t&&e.preventDefault(),38===t)return $(".el-active").each(function(){var e;return e=parseInt($(this).css("top")),$(this).css("top",e-1+"px")});if(40===t)return $(".el-active").each(function(){var e;return e=parseInt($(this).css("top")),$(this).css("top",e+1+"px")});if(37===t)return $(".el-active").each(function(){var e;return e=parseInt($(this).css("left")),$(this).css("left",e-1+"px")});if(39===t)return $(".el-active").each(function(){var e;return e=parseInt($(this).css("left")),$(this).css("left",e+1+"px")})}}),$(document).ready(function(){var e,t,i;return $(".maketooltip").tooltip(),$(".showclass").click(function(){var e;return e=$(this).data("element"),$(e).toggle()}),i=new Firebase("https://neuralframes.firebaseio.com/"),e=new FirebaseSimpleLogin(i,function(e,t){var s;return!e&&t?(console.log("Welcome back, "+t.email+" ("+t.id+")"),$(".requirelogin").show(),$(".signin-section").hide(),$(".signedin-section").show(),$(".canvas-list").show(),$(".new-canvas-title").show(),$(".hello-msg").text("Signed in: "+t.email),s=i.child("userdata").child(t.id).child("frames"),s.on("value",function(e){var t,i,s;if(null!==e.val()){$(".frames-list").empty(),s=e.val();for(t in s)i=s[t],$(".frames-list").append("<option value='"+t+"' data-key='"+t+"'>"+i.title+"</option>"),$(".frame-title-container").hide();return $(".frames-list").append("<option value='framenew'>New Entry</option>")}}),"framenew"===$(".frames-list").val()?$(".frame-title-container").show():$(".frame-title-container").hide(),$(".frames-list").change(function(){return"framenew"===$(this).val()?$(".frame-title-container").show():$(".frame-title-container").hide()}),$(".save").show(),$(".save").click(function(){var e,s,l,a,n,o,r,d,c,u,h;if(d=$(".frame-title").val(),"framenew"!==$(".frames-list").val()||""!==d&&void 0!==d){for("framenew"===$(".frames-list").val()?(a=i.child("userdata").child(t.id).child("frames").push({title:d}),l=a.name()):l=$(".frames-list").val(),s=i.child("userdata").child(t.id).child("frames").child(l),o=[],$(".workspace").find(".el").each(function(){return o.push($(this).data("elid"))}),h=window.styles,n=c=0,u=h.length;u>c;n=++c)r=h[n],void 0!==r&&void 0!==$("#elid-"+n)?(e=$("#elid-"+n),s.child("elements").child(n).child("el-style").set(r),s.child("elements").child(n).child("inc-class").set(e.attr("class")),s.child("elements").child(n).child("inline-style").child("top").set(e.css("top")),s.child("elements").child(n).child("inline-style").child("left").set(e.css("left")),s.child("elements").child(n).child("text").set(e.text()),e.data("ingroup")&&s.child("elements").child(n).child("ingroup").set(e.data("ingroup"))):s.child("elements").child(n).remove();return s.child("css").set($(".css-editor").val()),s.child("elidCtr").set(window.elidCtr),s.child("order").set(o),$(".frames-list").val(l)}return alert("no title")}),$(".delete").click(function(){var e;return e=$(".frame-title").val()}),$(".open").click(function(){var e,s;return"framenew"===$(".frames-list").val()?$(".frame-title-container").show():$(".frame-title-container").hide(),s=$(".frames-list").val(),e=i.child("userdata").child(t.id).child("frames").child(s),$(".workspace").empty(),window.styles=[],e.once("value",function(e){var t,i,l,a,n,o,r,d,c,u,h,p,v,f;if(null!==e.val()){if(window.elidCtr=e.val().elidCtr,e.val().order){for(h=e.val().order,r=0,c=h.length;c>r;r++)if(l=h[r],o=e.val().elements[l]){window.styles[l]={},p=o["el-style"];for(a in p)n=p[a],window.styles[l][a]=n;loadBox(l),jsonToPanel($("#elid-"+l)),jsonToClass($("#elid-"+l)),$("#elid-"+l).css("top",o["inline-style"].top),$("#elid-"+l).css("left",o["inline-style"].left),t=$("#elid-"+l).attr("class"),$("#elid-"+l).attr("class",o["inc-class"]),o.ingroup&&($("#elid-"+l).attr("data-ingroup",o.ingroup),i=Number(o.ingroup.substr(6)),groupctr=Math.max(groupctr,i)+1),$("#elid-"+l).find(".el-content").text(o.text)}}else for(v=e.val().elements,l=d=0,u=v.length;u>d;l=++d)if(o=v[l],void 0!==o){window.styles[l]={},f=o["el-style"];for(a in f)n=f[a],window.styles[l][a]=n;loadBox(l),jsonToPanel($("#elid-"+l)),jsonToClass($("#elid-"+l)),$("#elid-"+l).css("top",o["inline-style"].top),$("#elid-"+l).css("left",o["inline-style"].left),t=$("#elid-"+l).attr("class"),$("#elid-"+l).attr("class",o["inc-class"]),$("#elid-"+l).find(".el-content").text(o.text)}$(".css-editor").val(e.val().css),$(".css-editor").keyup()}return $(".frames-list").val(s)})})):$(".signin-section").show()}),$(".login").click(function(){return e.login("password",{email:$(".log-email").val(),password:$(".log-pw").val(),rememberMe:!0})}),$(".signup").click(function(){return e.createUser($(".log-email").val(),$(".log-pw").val(),function(e,t){return e?void 0:console.log("New User, Id: "+t.uid+", Email: "+t.email)})}),$(".fwdallBox").click(function(){var e,t;return e=$(".el-active"),t=$(".workspace").find(".el").last(),e.insertAfter(t)}),$(".fwdBox").click(function(){var e,t;return e=$(".el-active"),t=$(".el-active").next(),0!==t.length?e.insertAfter(t):void 0}),$(".backBox").click(function(){var e,t;return e=$(".el-active"),t=$(".el-active").prev(),0!==t.length?e.insertBefore(t):void 0}),$(".backallBox").click(function(){var e,t;return e=$(".el-active"),t=$(".workspace").find(".el").first(),e.insertBefore(t)}),$(".groupBox").click(function(){return $(".el-active").each(function(){}),$(".el-active").attr("data-ingroup","group-"+groupctr),$(".el-active").draggable("option","alsoDrag",".el[data-ingroup='group-"+groupctr+"']"),$(".el-active").resizable("option","alsoResize",".el[data-ingroup='group-"+groupctr+"']"),groupctr++}),$(".ungroupBox").click(function(){return $(".el-active").each(function(){return $(this).removeAttr("data-ingroup"),$(this).removeClass("el-active")})}),$(".deleteBox").click(function(){var e;return 0!==$(".el-active").length?(e=$(".el-active").data("elid"),styles[e]=void 0,$(".el-active").remove()):void 0}),t=new Behave({textarea:document.getElementById("css-editor"),replaceTab:!0,softTabs:!0,tabSize:2,autoOpen:!0,overwrite:!0,autoStrip:!0,autoIndent:!0}),$(".set-color").minicolors({position:"bottom right"}),$(".set-bk-color").minicolors({position:"bottom right"}),$(".set-border-color").minicolors({position:"bottom right"}),$(".set-outershadow-c").minicolors({position:"bottom right"}),$(".set-innershadow-c").minicolors({position:"bottom right"}),$(".dummy-color").minicolors({position:"top right"}),$(document).on("dblclick",".el",function(){return $(this).find(".el-content").attr("contentEditable",!0).focus()}),$(".css-includes").keyup(function(){return $(".el-active").attr("class","el el-box el-active").addClass($(this).val())}),$(".css-editor").keyup(function(){return $("#userstyle").empty(),$("#userstyle").append($(this).val())}),$(".elidstyle").keyup(function(){return panelToInline($(".el-active")),panelToJSON($(".el-active")),jsonToClass($(".el-active"))}),$(".elidstyle").change(function(){return panelToInline($(".el-active")),panelToJSON($(".el-active")),jsonToClass($(".el-active"))}),$(".set-gradient").bind("keyup change",function(){var e,t,i;return i=$(".set-bk-color").val(),t=getColorLuminance(i,-$(this).val()),e="background-image: -o-linear-gradient(-90deg, "+i+" 0%, "+t+" 100%);\nbackground-image: -moz-linear-gradient(-90deg, "+i+" 0%, "+t+" 100%);\nbackground-image: -ms-linear-gradient(-90deg, "+i+" 0%, "+t+" 100%);\nbackground-image: linear-gradient(-180deg, "+i+" 0%, "+t+" 100%);",$(".set-gradient-code").val(e)}),$(".set-shadow").bind("keyup change",function(){var e,t,i,s,l,a,n,o;return n=$(".set-outershadow-x").val(),o=$(".set-outershadow-y").val(),e=$(".set-outershadow-b").val(),a=$(".set-outershadow-s").val(),t=$(".set-outershadow-c").val(),""!==$(".set-outershadow-c").val()&&(l=""+n+"px "+o+"px "+e+"px "+a+"px "+t),n=$(".set-innershadow-x").val(),o=$(".set-innershadow-y").val(),e=$(".set-innershadow-b").val(),a=$(".set-innershadow-s").val(),t=$(".set-innershadow-c").val(),""!==$(".set-innershadow-c").val()&&(s="inset "+n+"px "+o+"px "+e+"px "+a+"px "+t),i=void 0!==l&&void 0===s?"-moz-box-shadow: "+l+"; \nbox-shadow: "+l+";":void 0===l&&void 0!==s?"-moz-box-shadow: "+s+"; \nbox-shadow: "+s+";":void 0!==l&&void 0!==s?"-moz-box-shadow: "+l+", "+s+"; \nbox-shadow: "+l+", "+s+";":"",$(".set-shadow-code").val(i)}),$(".updatePageDim").click(function(){var e,t,i;return 0===$(".page").length?(t=$("<div class='page'></div>"),t.draggable({}),t.resizable()):t=$(".page"),i=$(".pageWidth").val(),e=$(".pageHeight").val(),$(".workspace").css("background","#FFFFFF").css("width",i)}),$(".dupBox").click(function(){var e,t,i,s,l,a;if(0!==$(".el-active").length){s=$(".el-active").data("elid"),i=$(".el-active").attr("class"),$(".addBox").click(),e=$(".el-active").data("elid"),$(".el-active").attr("class",i),window.styles[e]={},a=styles[s];for(t in a)l=a[t],window.styles[e][t]=window.styles[s][t];return jsonToPanel($(".el-active")),jsonToClass($(".el-active"))}}),$(".workspace").click(function(e){return $(e.target).hasClass("workspace")?$(".el-active").removeClass("el-active"):void 0}),window.elidCtr=0,$(".addBox").click(function(){return addBox(elidCtr),elidCtr++}),$(".createclass").click(function(){var e,t,i;return i=$(".el-active").data("elid"),e=$("#style-"+i).html(),e=e.replace("#elid-"+i,".newstyle"),t=$(".css-editor").val(),$(".css-editor").val(e+"\n"+t),$("#csseditorlink").click()}),$(".resetcss").click(function(){return setDefaultStyle(function(){return panelToJSON($(".el-active")),jsonToClass($(".el-active"))})})}),loadBox=function(e){var t;return t=$("<div class='el el-box' id='elid-"+e+"' data-elid='"+e+"'></div>"),t.append($("<div class='el-content'></div>")),t.draggable({grid:[5,5],alsoDrag:".el-active",start:function(){return updateClasses($(this))},stop:function(){return inlineToPanel(t)}}),t.resizable({grid:[5,5],alsoResize:".el-active",stop:function(){return t.attr("ingroup")&&$("."+t.attr("ingroup")).each(function(){return inlineToPanel($(this)),panelToJSON($(this)),jsonToClass($(this))}),$(".el-active").each(function(){return inlineToPanel($(this)),panelToJSON($(this)),jsonToClass($(this))})}}),t.click(function(e){return e.shiftKey?makeActive($(this),!1):makeActive($(this),!0),updateClasses($(this)),inlineToPanel($(this))}),$(".workspace").append(t)},addGroupBox=function(e){var t;return t=$("<div class='el el-group' id='elid-"+e+"' data-elid='"+e+"'></div>"),t.append($("<div class='el-content'></div>")),t.draggable({grid:[5,5],start:function(){return makeActive($(this)),updateClasses($(this))},stop:function(){return inlineToPanel(t)}}),t.resizable({grid:[5,5],stop:function(){return inlineToPanel(t),panelToJSON(t),jsonToClass(t)}}),t.click(function(e){return e.shiftKey?makeActive($(this),!1):makeActive($(this),!0),updateClasses($(this)),inlineToPanel($(this))}),$(".workspace").append(t)},addBox=function(e){return setDefaultStyle(function(){var t;return t=$("<div class='el el-box' id='elid-"+e+"' data-elid='"+e+"'></div>"),t.append($("<div class='el-content'></div>")),t.addClass("defaultbox"),t.draggable({grid:[5,5],alsoDrag:".el-active",start:function(){return updateClasses($(this))},stop:function(){return inlineToPanel(t)}}),t.resizable({grid:[5,5],alsoResize:".el-active",stop:function(){return t.attr("ingroup")&&$("."+t.attr("ingroup")).each(function(){return inlineToPanel($(this)),panelToJSON($(this)),jsonToClass($(this))}),$(".el-active").each(function(){return inlineToPanel($(this)),panelToJSON($(this)),jsonToClass($(this))})}}),makeActive(t),updateClasses(t),t.click(function(e){return e.shiftKey?makeActive($(this),!1):makeActive($(this),!0),updateClasses($(this)),inlineToPanel($(this))}),$(".workspace").append(t),$(".set-size-w").val("200px"),$(".set-size-h").val("50px"),panelToJSON(t),jsonToClass(t)})},setDefaultStyle=function(e){return $(".elidstyle").val(""),$(".set-pos-top").val("20px"),$(".set-pos-left").val("20px"),$(".set-outershadow-x").val("1"),$(".set-outershadow-y").val("1"),$(".set-outershadow-b").val("3"),$(".set-outershadow-s").val("0"),$(".set-innershadow-x").val("0"),$(".set-innershadow-y").val("0"),$(".set-innershadow-b").val("3"),$(".set-innershadow-s").val("0"),e()},window.styles=[],panelToInline=function(e){var t;return t=e.data("elid"),e.css("top",$(".set-pos-top").val()),e.css("left",$(".set-pos-left").val())},panelToJSON=function(e){var t;return t=e.data("elid"),void 0===window.styles[t]&&(window.styles[t]={}),window.styles[t].width=$(".set-size-w").val(),window.styles[t].height=$(".set-size-h").val(),window.styles[t].textalign=$(".set-text-align").val(),window.styles[t].fontfamily=$(".set-font-family").val(),window.styles[t].fontweight=$(".set-font-weight").val(),window.styles[t].fontsize=$(".set-font-size").val(),window.styles[t].lineheight=$(".set-line-height").val(),window.styles[t].color=$(".set-color").val(),window.styles[t].borderradius=$(".set-border-radius").val(),window.styles[t].border=$(".set-border").val(),window.styles[t].bordercolor=$(".set-border-color").val(),window.styles[t].margin=$(".set-margin").val(),window.styles[t].padding=$(".set-padding").val(),window.styles[t].opacity=$(".set-opacity").val(),window.styles[t].backgroundcolor=$(".set-bk-color").val(),window.styles[t].gradientcode=$(".set-gradient-code").val(),window.styles[t].shadowcode=$(".set-shadow-code").val()},displayOnlyDefined=function(e){return void 0===e?"":e},jsonToPanel=function(e){var t;return t=e.data("elid"),$(".set-size-w").val(displayOnlyDefined(window.styles[t].width)),$(".set-size-h").val(displayOnlyDefined(window.styles[t].height)),$(".set-text-align").val(displayOnlyDefined(window.styles[t].textalign)),$(".set-font-family").val(displayOnlyDefined(window.styles[t].fontfamily)),$(".set-font-weight").val(displayOnlyDefined(window.styles[t].fontweight)),$(".set-font-size").val(displayOnlyDefined(window.styles[t].fontsize)),$(".set-line-height").val(displayOnlyDefined(window.styles[t].lineheight)),$(".set-color").val(displayOnlyDefined(window.styles[t].color)),$(".set-border-radius").val(displayOnlyDefined(window.styles[t].borderradius)),$(".set-border").val(displayOnlyDefined(window.styles[t].border)),$(".set-border-color").val(displayOnlyDefined(window.styles[t].bordercolor)),$(".set-margin").val(displayOnlyDefined(window.styles[t].margin)),$(".set-padding").val(displayOnlyDefined(window.styles[t].padding)),$(".set-opacity").val(displayOnlyDefined(window.styles[t].opacity)),$(".set-bk-color").val(displayOnlyDefined(window.styles[t].backgroundcolor)),$(".set-gradient-code").val(displayOnlyDefined(window.styles[t].gradientcode)),$(".set-shadow-code").val(displayOnlyDefined(window.styles[t].shadowcode))},displayCSSChunk=function(e,t){return void 0===t||""===t?"":void 0===e||""===e?t+"\n":"  "+e+": "+t+"; \n"},jsonToClass=function(e){var t,i,s;return i=e.data("elid"),0===$("#style-"+i).length&&(s=$("<style id='style-"+i+"'></style>"),$("head").append(s)),t="#elid-"+i+" {\n"+displayCSSChunk("width",window.styles[i].width)+displayCSSChunk("height",window.styles[i].height)+displayCSSChunk("top",window.styles[i].top)+displayCSSChunk("left",window.styles[i].left)+displayCSSChunk("font-family",window.styles[i].fontfamily)+displayCSSChunk("font-size",window.styles[i].fontsize)+displayCSSChunk("line-height",window.styles[i].lineheight)+displayCSSChunk("font-weight",window.styles[i].fontweight)+displayCSSChunk("text-align",window.styles[i].textalign)+displayCSSChunk("color",window.styles[i].color)+displayCSSChunk("border-radius",window.styles[i].borderradius)+displayCSSChunk("border",window.styles[i].border)+displayCSSChunk("border-color",window.styles[i].bordercolor)+displayCSSChunk("margin",window.styles[i].margin)+displayCSSChunk("padding",window.styles[i].padding)+displayCSSChunk("opacity",window.styles[i].opacity)+displayCSSChunk("background-color",window.styles[i].backgroundcolor)+displayCSSChunk(!1,window.styles[i].gradientcode)+displayCSSChunk(!1,window.styles[i].shadowcode)+"}",$("#style-"+i).html(t)},inlineToPanel=function(e){var t,i,s,l;return l=e.css("width"),t=e.css("height"),s=e.css("top"),i=e.css("left"),$(".set-size-w").val(l),$(".set-size-h").val(t),$(".set-pos-top").val(s),$(".set-pos-left").val(i),e.attr("style","top: "+s+"; left: "+i)},makeActive=function(e,t){return(void 0===t||t===!0)&&$(".el-active").removeClass("el-active"),e.addClass("el-active"),e.data("ingroup")&&$(".el[data-ingroup='"+e.data("ingroup")+"']").addClass("el-active"),void 0!==window.styles[e.data("elid")]?(jsonToPanel(e),jsonToClass(e)):(panelToJSON(e),jsonToClass(e))},updateClasses=function(e){var t,i,s,l,a,n;for(i=e.attr("class").split(" "),s="",l=["el","el-box","el-active","ui-draggable","ui-draggable-dragging","ui-resizable"],a=0,n=i.length;n>a;a++)t=i[a],l.indexOf(t)<=-1&&(s+=t+" ");return $(".css-includes").val(s)},getColorLuminance=function(e,t){var i,s,l;for(e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0,l="#",i=0,s=0;3>s;)i=parseInt(e.substr(2*s,2),16),i=Math.round(Math.min(Math.max(0,i+i*t),255)).toString(16),l+=("00"+i).substr(i.length),s++;return l},rgb2hex=function(e){return e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+hex(e[1])+hex(e[2])+hex(e[3])},hex=function(e){return isNaN(e)?"00":hexDigits[(e-e%16)/16]+hexDigits[e%16]},hexDigits=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");